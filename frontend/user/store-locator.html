<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>V·ªã tr√≠ C·ª≠a h√†ng - PhoneShop</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <link rel="stylesheet" href="../assets/css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      :root {
        --bs-border-radius: 0.75rem;
      }
      #map-container {
        height: 500px;
        border-radius: var(--bs-border-radius);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      #map-iframe {
        width: 100%;
        height: 100%;
        border: 0;
      }
      .store-list-item {
        cursor: pointer;
        transition: background-color 0.2s;
        border-radius: 0.5rem;
        border-left: 3px solid transparent;
      }
      .store-list-item.active,
      .store-list-item:hover {
        background-color: #f0f8ff;
        border-left-color: var(--bs-primary);
      }
      .store-list-item i {
        width: 20px;
      }
    </style>
  </head>
  <body>
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-primary"
      id="navbar"
    ></nav>
    <div class="container my-5">
      <h2 class="mb-4 text-primary">
        <i class="fas fa-map-marker-alt me-2"></i> H·ªá th·ªëng C·ª≠a h√†ng t·∫°i TP. HCM
      </h2>

      <div class="row g-4">
        <div class="col-md-4">
          <div class="list-group shadow-sm" id="storeListContainer">
            <h5 class="list-group-item active rounded-top-3">
              Ch·ªçn c·ª≠a h√†ng g·∫ßn b·∫°n
            </h5>
            <div id="store-list-content">
              <div class="text-center py-5 text-muted">ƒêang t·∫£i v·ªã tr√≠...</div>
            </div>
          </div>
        </div>

        <div class="col-md-8">
          <div id="map-container">
            <iframe
              id="map-iframe"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3919.6644073030235!2d106.69970921473138!3d10.76014389232938!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752f3607ccfddb%3A0x868b555d44477c7f!2sDistrict%201%2C%20Ho%20Chi%20Minh%20City%2C%20Vietnam!5e0!3m2!1sen!2s!4v1700000000000!5m2!1sen!2s"
              allowfullscreen
            ></iframe>
          </div>
          <div
            class="alert alert-info mt-3"
            id="directionsLink"
            style="display: none"
          ></div>
        </div>
      </div>
    </div>

    <script src="../assets/js/api.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script>
      // üéØ D·ªÆ LI·ªÜU V·ªä TR√ç GI·∫¢ ƒê·ªäNH T·∫†I TP. HCM
      const stores = [
        {
          id: 1,
          name: "PhoneShop Qu·∫≠n 1 (Tr·ª• s·ªü ch√≠nh)",
          address: "123 ƒê∆∞·ªùng Nguy·ªÖn Hu·ªá, Ph∆∞·ªùng B·∫øn Ngh√©, Qu·∫≠n 1, TP.HCM",
          phone: "028 1234 5678",
        },
        {
          id: 2,
          name: "PhoneShop Qu·∫≠n 3",
          address: "456 V√µ VƒÉn T·∫ßn, Ph∆∞·ªùng 6, Qu·∫≠n 3, TP.HCM",
          phone: "028 9876 5432",
        },
        {
          id: 3,
          name: "PhoneShop Th·ªß ƒê·ª©c",
          address: "789 ƒê∆∞·ªùng Kha V·∫°n C√¢n, Ph∆∞·ªùng Linh Chi·ªÉu, TP. Th·ªß ƒê·ª©c",
          phone: "028 3333 4444",
        },
        {
          id: 4,
          name: "PhoneShop Qu·∫≠n 7",
          address: "101 Nguy·ªÖn Th·ªã Th·∫≠p, Ph∆∞·ªùng T√¢n Quy, Qu·∫≠n 7, TP.HCM",
          phone: "028 5555 6666",
        },
      ];

      // üéØ HI·ªÇN TH·ªä DANH S√ÅCH C·ª¨A H√ÄNG
      function renderStoreList() {
        const listContent = document.getElementById("store-list-content");
        listContent.innerHTML = stores
          .map(
            (store) => `
            <div class="list-group-item store-list-item p-3" onclick="selectStore(${store.id}, '${store.address}')">
                <h6 class="text-primary mb-1">${store.name}</h6>
                <p class="mb-0 small text-muted"><i class="fas fa-location-arrow me-2"></i> ${store.address}</p>
                <p class="mb-0 small text-success"><i class="fas fa-phone me-2"></i> ${store.phone}</p>
            </div>
          `
          )
          .join("");
      }

      /**
       * X·ª≠ l√Ω ch·ªçn c·ª≠a h√†ng, c·∫≠p nh·∫≠t iframe ƒë·ªÉ hi·ªÉn th·ªã v·ªã tr√≠ v√† t·∫°o link ch·ªâ ƒë∆∞·ªùng.
       */
      function selectStore(id, destinationAddress) {
        // 1. Highlight m·ª•c ƒë∆∞·ª£c ch·ªçn
        document
          .querySelectorAll(".store-list-item")
          .forEach((el) => el.classList.remove("active"));
        document
          .querySelector(
            `.list-group-item[onclick="selectStore(${id}, '${destinationAddress}')"]`
          )
          .classList.add("active");

        const storeName = stores.find((s) => s.id === id).name;

        const encodedDestination = encodeURIComponent(destinationAddress);
        const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodedDestination}&travelmode=driving`;

        const directionsLinkEl = document.getElementById("directionsLink");
        const iframe = document.getElementById("map-iframe");

        // 2. C·∫¨P NH·∫¨T IFRAME ƒë·ªÉ hi·ªÉn th·ªã V·ªä TR√ç M·ªöI (M√¥ ph·ªèng "ch·ªâ ƒë∆∞·ªùng trong trang")
        // S·ª≠ d·ª•ng mode 'q' cho t√¨m ki·∫øm/v·ªã tr√≠ nh√∫ng c√¥ng khai
        iframe.src = `https://maps.google.com/maps?q=${encodedDestination}&t=&z=16&ie=UTF8&iwloc=&output=embed`;

        directionsLinkEl.style.display = "block";
        directionsLinkEl.innerHTML = `
             <i class="fas fa-route"></i> 
             V·ªã tr√≠ hi·ªán t·∫°i c·ªßa <b>${storeName}</b>
             <a href="${directionsUrl}" target="_blank" class="btn btn-sm btn-success ms-3 shadow-sm">
                 <i class="fas fa-external-link-alt"></i> B·∫Øt ƒë·∫ßu Ch·ªâ ƒë∆∞·ªùng (M·ªü Maps)
             </a>
          `;
      }

      document.addEventListener("DOMContentLoaded", () => {
        renderStoreList();
      });
    </script>
  </body>
</html>
